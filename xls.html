<!DOCTYPE html>
<html lang="en">
    <head> 
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <title>Exel to pdf</title> 
    </head>
    <body>
        <div class="container my-5">
            <div class="card">
                <div class="card-body">
                    <div class="row pt-5 justify-content-center">
                        <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                            <label for="excelfile" class="form-label">Select Excel file</label>
                            <input type="file"  class="form-control" id="excelfile" /> 
                        </div>
                    </div>
                    <div class="row my-3 justify-content-center">
                        <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 text-center">
                            <input type="button" class="btn btn-success mt-3 px-5" id="viewfile" value="Submit" onclick="ExportToPdfView()" /> 
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-5 mb-2 download-button d-none">
                <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 text-end">
                    <button class="btn btn-success" onclick="downloadPdf()">Download</button>
                    <!-- <button class="btn btn-success" onclick="window.print()">Print</button> -->
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="row mt-5">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                            <div id="element-to-print">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        


        <script src="assets/js/jquery.min.js"></script>
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="assets/js/html2pdf.bundle.min.js"></script>
        <script src="assets/js/xlsx.core.min.js"></script>  
        <script src="assets/js/xls.core.min.js"></script>

        <script type="text/javascript">
            function downloadPdf() {
                //$('#element-to-print').text('dfadfa dfasfdafa dfasfafsaf fadfasfsa dfadfasfasdf dfadfasdf asdfasfd fdasfd');
                var element = document.getElementById('element-to-print');
                var opt = {
                    margin:       1,
                    filename:     'myfile.pdf',
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2 },
                    jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' },
                    pagebreak: { mode: 'avoid-all', after: '.single-row' }
                };

                // New Promise-based usage:
                html2pdf().set(opt).from(element).save();

                // Old monolithic-style usage:
                html2pdf(element, opt);
            }

        </script>

        <script>
            function ExportToPdfView() {  
                var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xlsx|.xls)$/;  
                /*Checks whether the file is a valid excel file*/  
                if (regex.test($("#excelfile").val().toLowerCase())) {  
                    var xlsxflag = false; /*Flag for checking whether excel is .xls format or .xlsx format*/  
                    if ($("#excelfile").val().toLowerCase().indexOf(".xlsx") > 0) {  
                        xlsxflag = true;  
                    }  
                    /*Checks whether the browser supports HTML5*/  
                    if (typeof (FileReader) != "undefined") {  
                        var reader = new FileReader();  
                        reader.onload = function (e) {  
                            var data = e.target.result;  
                            /*Converts the excel data in to object*/  
                            if (xlsxflag) {  
                                var workbook = XLSX.read(data, { type: 'binary' });  
                            }  
                            else {  
                                var workbook = XLS.read(data, { type: 'binary' });  
                            }  
                            /*Gets all the sheetnames of excel in to a variable*/  
                            var sheet_name_list = workbook.SheetNames;  
              
                            var cnt = 0; /*This is used for restricting the script to consider only first sheet of excel*/  
                            sheet_name_list.forEach(function (y) { /*Iterate through all sheets*/  
                                /*Convert the cell value to Json*/  
                                if (xlsxflag) {  
                                    var exceljson = XLSX.utils.sheet_to_json(workbook.Sheets[y]);  
                                }  
                                else {  
                                    var exceljson = XLS.utils.sheet_to_row_object_array(workbook.Sheets[y]);  
                                }  
                                if (exceljson.length > 0 && cnt == 0) {  
                                    BindRow(exceljson);  
                                    cnt++;  
                                }  

                                console.log('exceljson', exceljson);
                                console.log('sheet_name_list', sheet_name_list);
                            }); 
                        }  
                        if (xlsxflag) {/*If excel file is .xlsx extension than creates a Array Buffer from excel*/  
                            reader.readAsArrayBuffer($("#excelfile")[0].files[0]);  
                        }  
                        else {  
                            reader.readAsBinaryString($("#excelfile")[0].files[0]);  
                        }  
                    }  
                    else {  
                        alert("Sorry! Your browser does not support HTML5!");  
                    }  
                }  
                else {  
                    alert("Please upload a valid Excel file!");  
                }  
            }  

            function BindRow(jsondata) {/*Function used to convert the JSON array*/  
                var columns = BindColumnHeader(jsondata); /*Gets all the column headings of Excel*/  

                for (var i = 0; i < jsondata.length; i++) {  
                    console.log('jsondatassss: ', jsondata[i]);

                    var row = `<div class="single-row"> 
                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 text-center">
                                            <h3>To Whom It May Concern</h3>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                            This is to certify that Mr ${jsondata[i]['Name']}, ${jsondata[i]['Designation']} of 
                                            ${jsondata[i]['Department']} Department is a permanent employee of Devnet Limited. 
                                            He joined in the company on ${jsondata[i]['Joining Date']}. The company has paid total Tk 16,57,500 against as salary and allowance during the financial year ${jsondata[i]['Financial Year']} and assessment year ${jsondata[i]['Assessment Year']}. Details are given below.
                                            <br></br>

                                            <table class="table table-bordered">
                                                <thead>
                                                    <th width="70%">Paticulars</th>
                                                    <th width="30%">Amount of Taka</th>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Basic Pay</td>
                                                        <td>1000000</td>
                                                    </tr>
                                                    <tr>
                                                        <td>House Rent</td>
                                                        <td>450000</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Conveyance</td>
                                                        <td>10000</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Medical</td>
                                                        <td>10000</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Bonus</td>
                                                        <td>20000</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Total</th>
                                                        <th>1200000</th>
                                                    </tr>
                                                </tbody>
                                            </table>

                                            <br><br>
                                            <h5>Parvin Akhter</h5>
                                            Deputy Manager (Accounts & Finance) <br>
                                            Devnet Limited
                                        </div>
                                    </div>

                                </div>`;

                    $('#element-to-print').append(row);
                    $('.download-button').removeClass('d-none');
                }  
            }  

            function BindColumnHeader(jsondata) {/*Function used to get all column names from JSON*/  
                var columnSet = [];

                for (var i = 0; i < jsondata.length; i++) {  
                    var rowHash = jsondata[i];  
                    for (var key in rowHash) {  
                        if (rowHash.hasOwnProperty(key)) {  
                            if ($.inArray(key, columnSet) == -1) {/*Adding each unique column names to a variable array*/  
                                columnSet.push(key); 
                            }  
                        }  
                    }  
                }  

                return columnSet;  
            } 
        </script>
    </body>
</html>

